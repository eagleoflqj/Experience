# 命令
```sh
make [-f make文件] [目标]
```
* make文件默认Makefile
* 目标默认Makefile中第一个目标
# Makefile
## 基本格式
```Makefile
目标: [前提1 ...]
    [命令1
    ...]
```
* 若与目标同名的文件已存在且比前提文件新，则不执行命令
* 前提和命令至少指定一个
* 命令前必须为tab
* 每行命令在单独的shell执行
## 注释
每行`#`及其后内容
## 回显
* 默认执行每条命令前打印命令内容（包括注释）
* tab后加`@`关闭该行回显
* 一般用于纯注释或echo
## 通配符
与bash一致
## 模式匹配
目标和前提文件名的相同部分可用%匹配
```Makefile
%.o: %.c
```
## 变量
```Makefile
变量 = 值 # 运行时求值
变量 := 值 # 定义时求值
变量 ?= 值 # 运行时若变量为空则求值
变量 += 值 # 追加，求值时间取决于变量声明，若无声明则相当于=
```
* 调用使用`$(变量)`，Shell变量要`$$变量`
## 自动变量
变量|意义
-|-
$@|当前目标
$<|第一个前提
$?|比目标新的前提，空格分隔
$^|所有前提，空格分隔
$*|`%`匹配的部分
$(@D)|`$@`的路径部分
$(@F)|`$@`的文件名
$(<D) $(<F)|`$@`的路径部分、文件名
# 内置目标
## .ONESHELL 多行在同一shell执行
```Makefile
.ONESHELL:
目标: ...
    命令1
    ...
```
## .PHONY 伪目标
```Makefile
.PHONY: 目标1 [... 目标n]
```
* 声明为伪目标后，无论是否存在同名文件，均执行命令
# 内置变量
变量|说明|默认值
-|-|-
CC|C编译器|cc
MAKE|当前使用的make|make
# 特殊变量
## .RECIPEPREFIX 替换命令前导tab
```Makefile
.RECIPEPREFIX = 字符
```
* 从设置起生效，直到下一次修改
