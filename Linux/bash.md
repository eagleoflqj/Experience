# Bourne-Again SHell
```sh
bash [参数]
```
参数|意义
-|-
无|启动非登录bash
文件|在新bash中执行脚本
-c 命令字符串 [新bash可引用的$0 ... $n]|在新bash中执行命令
-l或--login|启动登录bash
--noediting|禁用readline库
--version|显示版本
* 登录shell：`$0`（以及`ps -f`的CMD列）以`-`开头或，`login`、`ssh`、tty1~6
* 非登录shell：shell中启动shell、GUI启动终端
* `/etc/passwd`每行最后一项指定登录shell
* 登录bash执行`~/.bash_profile`（CentOS）或`~/.profile`（Ubuntu），一般会在上述文件加入对`~/.bashrc`的执行
* 登录bash退出执行`~/.bash_logout`
* 非登录bash执行`~/.bashrc`
* 关闭终端时，前台、后台、暂停进程收到SIGHUP信号结束
# 内置命令
## bg 后台运行作业
```sh
bg [%作业号1 [... %作业号n]]
```
## cd 切换工作目录
```sh
cd - # 切换到上一个目录
```
## declare 声明变量类型
```sh
declare [选项 [变量[=值]]]
```
选项|意义
-|-
无|等同于`set`
-a|数组
-f|函数
-F|输出所有函数名
-i|整数
-l|小写字母
-p|查看变量
-r|只读
-u|大写字母
-x|环境变量
* 无变量则输出给定类型的变量
* 若声明时不赋值，则不改变已有的值
* `-i`后赋值，`=`右侧将自动解释为整数，参与运算的变量可以不带`$`
* `-l`、`-u`后赋值，自动转换大小写
* 若赋值类型不匹配，则结果不确定
## dirs 输出当前目录和目录栈
```sh
dirs [选项]
```
选项|意义
-|-
-c|清空目录栈
-l|家目录显示绝对路径
-p|分行输出
-v|分行并输出编号
+数字|第n项，从0开始
-数字|从后往前第n项，从0开始
* 目录栈从栈顶到栈底
## disown 忽略sighup
```sh
disown -h [%作业号或进程号]
```
* 关闭终端或exit当前shell时，后台R、S进程被接管，其他进程结束
## echo 输出并换行
```sh
echo [选项] 内容
echo "abc${变量}def"
```
选项|意义
-|-
-e|将无-e时的输出进行转义
-n|不自动换行
## exec 替换当前shell
```sh
exec [选项] 命令 [参数1 ...]
```
选项|意义
-|-
-a 参数0|传递给命令的参数0，否则为命令
-c|在空环境执行命令
-l|替换为登录shell
## exit 退出当前shell
```sh
exit
```
* T进程结束
* R、S进程（显然为后台进程）被接管，遇到IO时若终端已关闭（TTY为?）则结束，若未关闭则I阻塞，O输出到终端
## export 设置环境变量
```sh
export 变量[=值]
```
* 环境变量可供子进程访问，但子进程对其的修改、删除不影响父进程
* export后第二次可以直接赋值
* export时若变量未赋值，则仅在后续赋值后导出
## fg 前台运行作业
```sh
fg [%作业号]
```
## history 历史命令
```sh
history [选项]
```
选项|意义
-|-
-c|清空当前缓存，不影响~/.bash_history
## jobs 查看全部作业
```sh
jobs [参数]
```
参数|意义
-|-
-l|显示进程号
* +：fg、bg、disown默认的作业
* -：下一个默认的作业
## let 算术表达式赋值
```sh
let 赋值表达式1 [...]
```
* `=`右侧的变量可以不带`$`
## logout 登出当前账户
```sh
logout [返回值]
```
* 需要作用在登录shell，等同于exit
## popd 删除栈中目录
```sh
popd [选项]
```
选项|意义
-|-
无|弹出栈顶并切换，同`+0`
-n|弹出栈顶，同`+1`
+数字|删除`` `dir +数字` ``
-数字|删除`` `dir -数字` ``
## pushd 修改目录栈顶
```sh
pushd 选项或新目录
```
选项|意义
-|-
无|压栈当前目录并切换
+数字|循环左移`` `dir` ``，切换到`` `dir +数字` ``
-数字|循环左移`` `dir` ``，切换到`` `dir -数字` ``
## pwd 输出当前目录
```sh
pwd
```
## readonly 设置只读变量
```sh
readonly [变量[=值]]
```
## set 设置bash选项/查看bash变量
```sh
set [选项]
```
* 无选项则输出所有变量和函数
* 影响`$SHELLOPTS`

选项|意义
-|-
-f|关闭glob扩展
+h|关闭当前PATH下的命令位置hash缓存，每次顺序搜索PATH
-o emacs\|vi|Emacs或Vi快捷键，默认Emacs
-o noglob|关闭glob扩展
-o nounset|变量未定义时不返回空字符串，报错
## shopt 设置bash选项
```sh
shopt [[-s|-u] 选项]
```
* -s开启，-u关闭，无则查询
* 影响`$BASHOPTS`
### dotglob 匹配隐藏文件
### extglob 量词
语法|意义
-|-
?(模式)|匹配0或1次
*(模式)|匹配0或多次
+(模式)|匹配至少1次
@(模式)|匹配1次
!(模式)|所有情况，除了恰好匹配1次模式
* 多个模式`|`分隔
### failglob 若文件名匹配不存在，命令报错
### globstar **匹配0或多层子目录
### nocaseglob 大小写不敏感匹配
### nullglob 若文件名匹配不存在，返回空字符串
## source 在当前shell执行脚本
```sh
source 脚本
```
## type 判断命令类型
```sh
type [选项] 命令
```
选项|意义
-|-
-a|输出命令的所有定义，否则只输出使用中的定义
-t|只输出类型，alias、builtin、file、function、keyword
## ulimit shell资源限制
```sh
ulimit [选项 [数值或unlimited]]
```
选项|意义
-|-
-a|显示全部资源限定
-c|core文件块数
-d|数据段KB数
-e|nice优先级
-f|创建的文件块数
-i|阻塞信号数
-l|进程锁在内存KB数
-m|使用内存KB数
-n|同时打开文件数
-p|管道512B数
-q|POSIX消息队列字节数
-r|实时nice优先级
-s|栈KB数
-t|CPU秒数
-u|用户进程数
-v|虚拟内存KB数
-x|文件锁数
## umask 设置新文件默认权限
```sh
umask [参数]
```
参数|意义
-|-
无|查看当前掩码
-S|查看当前权限
0abc|设置新目录权限777-abc，新文件权限666-abc
## unset 删除变量
```sh
unset 变量1 [...]
```
* 不可删除只读变量
# 重定向
* 0标准输入
* 1标准输出 2标准错误 默认1  
* \>覆盖 \>\>追加
## 只显示错误
```sh
命令 >/dev/null
```
## 全不显示
```sh
命令 1>/dev/null 2>/dev/null 
命令 1>/dev/null 2>&1
```
# 数值
* 普通数字：十进制
* 先导0：八进制
* 先导0x：十六进制
* 基数#数值：2-64进制
* 基数<=36时，不区分大小写；基数>36时，先小写后大写，最后`@`和`_`
# Globbing
* 先解释，再执行；命令接受展开后的参数
* 若文件名匹配不存在，则不进行扩展
## \`命令\` 或 $(命令) 命令的标准输出
## ~ 家目录
## ~+ 当前目录
## ~用户 用户家目录
## !! 上一条命令
```sh
sudo !!
PYTHONIOENCODING=utf-8 !!
```
## !前缀 上一条匹配前缀的命令
## !编号 history显示的命令
## !-数字 history显示的倒数命令
## !?字符串 上一条包含字符串的命令
## $数字 命令的第n个参数
* `$0`为命令本身
## $变量 或 ${变量} 变量值
### ${变量:-值} 存在且非空时返回变量值，否则返回值
### ${变量:=值} 存在且非空时返回变量值，否则返回值，并为变量赋值
### ${变量:+值} 存在且非空时返回值，否则返回空
### ${变量:?消息} 存在且非空时返回变量值，否则输出消息并报错
### $! 上一个后台命令的PID
### $@ 当前函数实参数组
### $# 当前函数实参数
### $$ 当前shell的PID
### $_ 上一条命令的最后一个参数
### $- 当前SHELLOPTS的简写
### $? 上一条命令的返回值
## $((整数运算)) 或（不推荐）$[整数运算] 运算结果
## ${变量#模式} / ${变量##模式} 头部非贪婪/贪婪匹配
* 若匹配成功，返回未匹配的部分，否则返回原字符串
* 模式可使用`*`、`?`、`[]`或`[^]`
## ${变量%模式} / ${变量%%模式} 尾部非贪婪/贪婪匹配
## ${变量^^} 转为大写
## ${变量:起点:长度} 或 ${变量:起点} 提取子串
* 省略长度则到结尾
* 负数起点表示从后往前；为避免和变量默认值语法混淆，`-`前需有空格
* 0为第一个字符，-1为最后一个字符
## ${变量,,} 转为小写
## ${变量/模式/替换} / ${变量//模式/替换} 一次/所有贪婪匹配替换
## ${变量/#模式/替换} / ${变量/%模式/替换} 头/尾部贪婪匹配替换
## ${!变量} 间接表达式
* 变量值为另一变量名时，返回另一变量值，否则报错
## ${!前缀*} 或 ${!前缀@} 变量名
## ${#变量} 字符串长度
## ^字符串1^字符串2 上一条包含字符串1的命令，把字符串1替换成字符串
## * 0或多个字符
* 不匹配隐藏文件
* 不匹配路径分隔符
## ** 0或多层子目录
* 需开启globstar
## {字符串1,...,字符串n} 每个字符串出现一次
* 字符串可为空
* 大括号可以嵌套
* 与其他模式组合时，优先展开大括号
## {起点..终点[..步长]} 区间内字符串出现一次
* 支持逆序
* 无法迭代则原样输出
* 起点包含前导0，则所有字符串被扩展为等长，长度由最长字符串决定
## [字符1...字符n] 集合中单字符
* `-`只能放在开头或结尾
## [起点1-终点1...] 连续集合中单字符
## [[:POSIX字符类:]] 类中单字符
## [!...] 或 [^...] 集合外单字符
## ? 单个非空字符
* 不匹配路径分隔符
# 符号
## && 前一条命令成功则执行后一条
## ((表达式)) 整数运算
* 命令返回值：结果非0返回0，结果为0返回1
* 表达式可含空格
* 支持`+`、`-`、`*`、`/`（整除）、`%`、`**`（指数）、前后缀的`++`和`--`
* 支持`<<`、`>>`（算术）、`&`、`|`、`^`、`~`
* 支持`<`、`<=`、`>`、`>=`、`==`、`!=`、`&&`、`||`、`!`、`?:`
* 支持`=`及其变体
* 支持`,`，从左到右计算，结果为最右表达式
* 内部不需要`$`，字符串被当作变量名并执行任意次间接访问，直到取得合法数值/非法数值（报错）/不存在或空（0）
## -- 分隔选项和参数
```sh
kill -9 -- -进程组号
```
## || 前一条命令失败则执行后一条
## \ 转义
* 无引号：2n、2n+1个\\输出为n个\\
* 单引号：n个\\输出为n个\\
* 双引号：2n-1、2n个\\输出为n个\\
* 行尾：多行命令
## ; 同行多命令
## '' 保留引号内文本
* $'文本'：转义`\`
## "" 解释引号内文本
* 扩展`$`和`` ` ``
* 转义`\`的可打印字符
* 保留命令输出，例如``echo `cal` `` vs ``echo "`cal`"``
## << Here文档
```sh
命令 [参数1 ...] <<标识 [>输出]
内容
标识
```
本质为重定向，只能用于接受标准输入为参数的命令，等价于
```sh
echo 内容 | 命令 [参数1 ...] [>输出]
```
* 多行输入，直到遇到单独一行的标识
* `$`和`` ` ``被扩展，`\`被转义，`'`和`"`无语法效果
* 开始标识为`'标识'`时，不执行扩展和转义
## <<< Here字符串
```sh
命令 <<< 字符串
```
等价于
```sh
echo 字符串 | 命令
```
# Bash变量
## BASHOPTS shopt设置的选项
## BASHPID bash进程的PID
## BASH_VERSION bash版本
## IFS 词间分隔符
* 默认为`$' \t\n'`
* 用于for循环
## HISTFILE 历史命令存放文件
## HISTFILESIZE 保存历史命令数
## HISTSIZE 内存缓存历史命令数
## HISTTIMEFORMAT 命令时间戳
* `'%F %T '`，即`'%Y-%m-%d %H:%M:%S '`
## PS1 命令提示符
## PS2 多行命令时次要提示符
## RANDOM 0到32767的随机数
## UID 当前用户ID
# 环境变量
## DISPLAY GUI显示器
## HOME 用户家目录
## LANG 语言
* zh_CN.UTF-8
* 覆盖其他默认`LC_*`
## OLDPWD 上一个工作目录
## PATH 可执行文件搜索路径
* 顺序搜索，`:`分隔
## PWD 工作目录
## SHELL 当前shell
## SHLVL 当前shell层数
## TERM 终端类型
## USER 当前用户名
# 本地化配置
## LC_TIME 日期时间
## LC_ALL 所有配置
* 若非空则覆盖其他默认/非默认`LC_*`
* C或POSIX表示7位ASCII
# 代理配置
* 在DNS之前决定是否使用代理
## http_proxy https_proxy HTTP[S]代理
* 值为`[协议]IP:端口`
## no_proxy 不使用代理的网站
* `,`分隔
* 包括高级域名
# 快捷键
快捷键|意义
-|-
Alt+B|移动光标到左侧单词首字母
Alt+D|剪切光标右侧的单词
Alt+F|移动光标到右侧（含）单词尾字母后
Alt+L|光标至词尾转为小写
Alt+R|取消对来自history的命令的修改
Alt+U|光标至词尾转为大写
Alt+Backspace|剪切光标左侧的单词
Alt+Tab|从历史命令补全
Alt+.|插入上一条命令的最后一个词
Ctrl+A|移动光标到行首
Ctrl+B|左移光标
Ctrl+C|发送SIGINT
Ctrl+D|删除光标处字符，当前行无内容则发送EOF
Ctrl+E|移动光标到行尾
Ctrl+F|右移光标
Ctrl+K|剪切光标及右侧
Ctrl+L|清屏
Ctrl+N|下一条命令
Ctrl+O|回车并显示下一条命令，便于重复历史
Ctrl+P|上一条命令
Ctrl+R|搜索历史命令
Ctrl+T|光标位置字符与前一字符交换
Ctrl+U|剪切光标左侧
Ctrl+W|剪切光标左侧的单词
Ctrl+Y|粘贴
Ctrl+Z|暂停
Ctrl+/|撤销
* Alt可用ESC代替，但ESC不能长按
